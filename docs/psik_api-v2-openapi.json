{"openapi":"3.1.0","info":{"title":"psik API","summary":"An API for batch jobs and their files","description":"\nStop fussing with SLURM and shell background tasks.\nSetup, start, and monitor the progress of your batch\njobs using modern, secure, REST-API routes and callbacks.\n","version":"2.0.1"},"servers":[{"url":"/v2"}],"paths":{"/backends":{"get":{"tags":["backends"],"summary":"Get Backends","description":"Get information on all backends.","operationId":"get_backends_backends_get","parameters":[{"name":"name","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/SystemStatus"},"title":"Response Get Backends Backends Get"}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/backends/{name}":{"get":{"tags":["backends"],"summary":"Get Backend","description":"Get information on a specific backend.","operationId":"get_backend_backends__name__get","parameters":[{"name":"name","in":"path","required":true,"schema":{"type":"string","title":"Name"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SystemStatus"}}}},"404":{"description":"Not found"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs":{"get":{"tags":["jobs"],"summary":"Get Jobs","description":"Get information about jobs running on compute resources.\n\n  - index: the index of the last job info to retrieve\n           Jobs are sorted by time, so index 0 is the most recent job.\n  - limit: (optional) how many JobStepInfo-s to retrieve\n  - backend: (optional) the compute resource name\n  - state: (optional) filter by job state","operationId":"get_jobs_jobs_get","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"index","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Index"}},{"name":"limit","in":"query","required":false,"schema":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Limit"}},{"name":"backend","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Backend"}},{"name":"state","in":"query","required":false,"schema":{"anyOf":[{"$ref":"#/components/schemas/JobState"},{"type":"null"}],"title":"State"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/JobStepInfo"},"title":"Response Get Jobs Jobs Get"}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["jobs"],"summary":"Post Job","description":"Submit a job to run on a compute resource.\nIf submit is True (default), also submits the job to the\nqueue.\n\nOn success, this API will return the jobid created.","operationId":"post_job_jobs_post","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"submit","in":"query","required":false,"schema":{"type":"boolean","default":true,"title":"Submit"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobSpec"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string","title":"Response Post Job Jobs Post"}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{jobid}/start":{"post":{"tags":["jobs"],"summary":"Start Job","operationId":"start_job_jobs__jobid__start_post","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"jobid","in":"path","required":true,"schema":{"type":"string","title":"Jobid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{jobid}":{"get":{"tags":["jobs"],"summary":"Read Job","description":"Read job\n\n- jobid: the job's ID string","operationId":"read_job_jobs__jobid__get","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"jobid","in":"path","required":true,"schema":{"type":"string","title":"Jobid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/JobStepInfo"},"title":"Response Read Job Jobs  Jobid  Get"}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"tags":["jobs"],"summary":"Delete Job","operationId":"delete_job_jobs__jobid__delete","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"jobid","in":"path","required":true,"schema":{"type":"string","title":"Jobid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/callback":{"post":{"tags":["jobs"],"summary":"Do Callback","description":"Notify psik_api that a job has reached a given state.\nThis will call `psik.Job.reached`, forwarding\nthe callback along the chain.","operationId":"do_callback_jobs_callback_post","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"x-hub-signature-256","in":"header","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"X-Hub-Signature-256"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Callback"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ErrorStatus"}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{jobid}/state":{"get":{"tags":["jobs"],"summary":"Get State","description":"Read the current job's state.\n\n- jobid: str","operationId":"get_state_jobs__jobid__state_get","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"jobid","in":"path","required":true,"schema":{"type":"string","title":"Jobid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobState"}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{jobid}/logs":{"get":{"tags":["jobs"],"summary":"List Outputs","description":"Retreive all job logs.","operationId":"list_outputs_jobs__jobid__logs_get","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"jobid","in":"path","required":true,"schema":{"type":"string","title":"Jobid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"type":"string"},"title":"Response List Outputs Jobs  Jobid  Logs Get"}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{jobid}/scripts":{"get":{"tags":["jobs"],"summary":"Download Scripts","description":"Retreive all job scripts.","operationId":"download_scripts_jobs__jobid__scripts_get","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"jobid","in":"path","required":true,"schema":{"type":"string","title":"Jobid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"type":"string"},"title":"Response Download Scripts Jobs  Jobid  Scripts Get"}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{jobid}/files":{"get":{"tags":["jobs"],"summary":"List Output","description":"List all output files.","operationId":"list_output_jobs__jobid__files_get","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"jobid","in":"path","required":true,"schema":{"type":"string","title":"Jobid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"object","additionalProperties":{"$ref":"#/components/schemas/FileStat"},"title":"Response List Output Jobs  Jobid  Files Get"}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"post":{"tags":["jobs"],"summary":"Create Upload File","operationId":"create_upload_file_jobs__jobid__files_post","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"jobid","in":"path","required":true,"schema":{"type":"string","title":"Jobid"}}],"requestBody":{"required":true,"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_create_upload_file_jobs__jobid__files_post"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/{jobid}/files/{fname}":{"get":{"tags":["jobs"],"summary":"Download Output","operationId":"download_output_jobs__jobid__files__fname__get","security":[{"Biscuit token for authorization":[]}],"parameters":[{"name":"jobid","in":"path","required":true,"schema":{"type":"string","title":"Jobid"}},{"name":"fname","in":"path","required":true,"schema":{"type":"string","format":"path","title":"Fname"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/jobs/new":{"post":{"tags":["jobs"],"summary":"New Input","description":"Create a new job, but do not submit it.","operationId":"new_input_jobs_new_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/JobSpec"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"type":"string","title":"Response New Input Jobs New Post"}}}},"404":{"description":"Not found"},"401":{"description":"Unauthorized"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"Biscuit token for authorization":[]}]}},"/token":{"get":{"tags":["auth"],"summary":"Get Token","operationId":"get_token_token_get","responses":{"200":{"description":"Successful Response","content":{"text/plain":{"schema":{"type":"string"}}}},"404":{"description":"Not found"}}},"post":{"tags":["auth"],"summary":"Show Token","operationId":"show_token_token_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"404":{"description":"Not found"}},"security":[{"Biscuit token for authorization":[]}]}}},"components":{"schemas":{"Body_create_upload_file_jobs__jobid__files_post":{"properties":{"files":{"items":{"type":"string","format":"binary"},"type":"array","title":"Files","description":"Files uploaded as multipart/form-data"}},"type":"object","required":["files"],"title":"Body_create_upload_file_jobs__jobid__files_post"},"Callback":{"properties":{"jobid":{"type":"string","pattern":"^[0-9]+(\\.[0-9]+)?$","title":"Job ID"},"jobndx":{"type":"integer","title":"Sequential job index."},"state":{"$ref":"#/components/schemas/JobState","title":"State reached by job."},"info":{"type":"integer","title":"Status code.","default":0}},"type":"object","required":["jobid","jobndx","state"],"title":"Callback"},"ErrorStatus":{"type":"string","enum":["OK","ERROR"],"title":"ErrorStatus"},"FileStat":{"properties":{"size":{"type":"integer","title":"Size"},"atime":{"type":"integer","title":"Atime"},"mtime":{"type":"integer","title":"Mtime"},"children":{"anyOf":[{"type":"boolean"},{"additionalProperties":{"$ref":"#/components/schemas/FileStat"},"type":"object"}],"title":"Children"}},"type":"object","required":["size","atime","mtime","children"],"title":"FileStat"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"JobSpec":{"properties":{"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Job name"},"directory":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Job run directory"},"script":{"type":"string","title":"Shell / shebang script to execute"},"environment":{"additionalProperties":{"type":"string"},"type":"object","title":"custom environment variables","default":{}},"inherit_environment":{"type":"boolean","title":"If this flag is set to False, the job starts with an empty environment.","default":true},"resources":{"$ref":"#/components/schemas/ResourceSpec","title":"Job resource requirements","default":{"duration":10,"cpu_cores_per_process":1,"gpu_cores_per_process":0,"exclusive_node_use":true}},"backend":{"type":"string","title":"Configured backend name","default":"default"},"attributes":{"additionalProperties":{"type":"string"},"type":"object","title":"Backend attribute values.","default":{}},"callback":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"URL to send event notifications."},"cb_secret":{"anyOf":[{"type":"string","format":"password","writeOnly":true},{"type":"null"}],"title":"hmac256 secret to sign updates sent to 'callback'"},"client_secret":{"anyOf":[{"type":"string","format":"password","writeOnly":true},{"type":"null"}],"title":"hmac256 secret to validate callback updates from clients"}},"additionalProperties":false,"type":"object","required":["script"],"title":"JobSpec"},"JobState":{"type":"string","enum":["new","queued","active","completed","failed","canceled"],"title":"JobState"},"JobStepInfo":{"properties":{"jobid":{"type":"string","title":"Jobid"},"name":{"type":"string","title":"Name"},"updated":{"type":"number","title":"Updated"},"jobndx":{"type":"integer","title":"Jobndx"},"state":{"$ref":"#/components/schemas/JobState"},"info":{"type":"integer","title":"Info"}},"type":"object","required":["jobid","name","updated","jobndx","state","info"],"title":"JobStepInfo"},"ResourceSpec":{"properties":{"duration":{"type":"integer","title":"Max walltime of the job in minutes","default":10},"node_count":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Number of compute nodes allocated to job."},"process_count":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Instruct the backend to start this many process instances. Mutually exclusive with node+processes_per_node. Default if neither is 1 process."},"processes_per_node":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Processes Per Node"},"cpu_cores_per_process":{"type":"integer","title":"CPU cores for each process instance.","default":1},"gpu_cores_per_process":{"type":"integer","title":"Gpu Cores Per Process","default":0},"exclusive_node_use":{"type":"boolean","title":"Exclusive Node Use","default":true}},"type":"object","title":"ResourceSpec"},"StatusValue":{"type":"string","enum":["active","unavailable","degraded","other"],"title":"StatusValue"},"SystemStatus":{"properties":{"name":{"type":"string","title":"System Name"},"full_name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Full System Name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description"},"system_type":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"System Type"},"notes":{"items":{"type":"string"},"type":"array","title":"Status Notes","default":[]},"status":{"$ref":"#/components/schemas/StatusValue"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"}},"type":"object","required":["name","status"],"title":"SystemStatus"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"Biscuit token for authorization":{"type":"http","description":"Optional - may be obtained from /token","scheme":"bearer","bearerFormat":"biscuit"}}},"tags":[{"name":"backends","description":"psik backend information (e.g. status)"},{"name":"jobs","description":"Manage jobs on configured compute backends."},{"name":"auth","description":"Create authorization tokens."}]}